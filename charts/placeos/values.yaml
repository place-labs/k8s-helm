# Default values for the placeos umbrella chart.


###############################
##### Configmap Variable ######
###############################

# xrethinkdbPassword the admin password for RethinkDb.
#  Used to set the admin password in RethinkDB if enabled is used by multiple containers in a k8s secret
xrethinkdbPassword: &rethinkdbPassword "password"

# xsmtpPassword. the smtp password used by triggers
xsmtpPassword: &smtpPassword ""

# xplacePassword. The value used by the init subchart to set the default domain users password
xplacePassword: &placePassword "development"

# xserverSecret for the dispatch service
xserverSecret: &serverSecret "development"

# xtz the local time zone for the deployment
xtz: &TZ Australia/Sydney

# xdeploymentEnv configmap values exposed as environment variables to PlaceOS containers
xdeploymentEnv: &deploymentEnv
  ENV: development
  SG_ENV: development
  TZ: *TZ

# xelasticClientEnv configmap values for ElasticSearch Service exposed as environment variables to PlaceOS containers
xelasticClientEnv: &elasticClientEnv
  ES_HOST: elasticsearch-master
  ES_PORT: 9200

# xetcdClientEnv configmap values for Etcd end point Service as environment variables to PlaceOS containers
xetcdClientEnv: &etcdClientEnv
  ETCD_HOST: etcd-headless
  ETCD_PORT: 2379

# xplaceLoaderClientEnv configmap values for the frontend Service exposed as environment variables to PlaceOS containers
xplaceLoaderClientEnv: &placeLoaderClientEnv
  PLACE_LOADER_URI: http://frontends:3000

# xredisClientEnv configmap values for the redis Service exposed as environment variables to PlaceOS containers
xredisClientEnv: &redisClientEnv
  REDIS_URL: redis://redis-headless:6379

# xrethinkdbClientEnv configmap values for RethinkDB Service exposed as environment variables to PlaceOS containers
xrethinkdbClientEnv: &rethinkdbClientEnv
  RETHINKDB_HOST: rethinkdb-proxy
  RETHINKDB_PORT: 28015
  RETHINKDB_DB: place_development
  RETHINKDB_USER: admin

# xrethinkdbClientSecrets secret values for the rethinkdb password exposed as environment variables to PlaceOS containers
xrethinkdbClientSecrets: &rethinkdbClientSecrets
  RETHINKDB_PASSWORD: *rethinkdbPassword

# xrubberSoulClientEnv configmap values for the Rubber Soul service exposed as environment variables to PlaceOS containers
xrubberSoulClientEnv: &rubberSoulClientEnv
  RUBBER_SOUL_URI: http://rubbersoul:3000

# xsmtpClientEnv configmap values for the SMTP server exposed as environment variables for the trigger service
xsmtpClientEnv: &smtpClientEnv
  SMTP_SERVER: ""
  SMTP_PORT: 587
  SMTP_USER: ""
  SMTP_SECURE: ""

xinitConfigEnv: &initConfigEnv
    PLACE_APPLICATION: backoffice
    PLACE_AUTH_HOST: auth:3000
    PLACE_USERNAME: "Place Support"
    PLACE_EMAIL: support@place.tech
    PLACE_TLS: true

# xsmtpClientSecrets secrets values exposed as environment variables for the trigger service
xsmtpClientSecrets: &smtpClientSecrets
  SMTP_PASS: *smtpPassword

# dispatchSecrets secret values exposed as environment variables for the dispatch service
xdispatchSecrets: &dispatchSecrets
  SERVER_SECRET: *serverSecret

#####################################
##### PlaceOS Service SubCharts #####
#####################################

# api is the overide configuration for the embedded api subchart
api:
  enabled: true
  fullnameOverride: api
  configmap:
    # Environment
    << : *deploymentEnv
    # Service Hosts
    << : *elasticClientEnv
    << : *etcdClientEnv
    << : *placeLoaderClientEnv
    << : *redisClientEnv
    << : *rethinkdbClientEnv
    << : *rubberSoulClientEnv
  secrets:
    << : *rethinkdbClientSecrets
# auth is the overide configuration for the embedded auth subchart
auth:
  enabled: true
  fullnameOverride: auth
  configmap:
    << : *rethinkdbClientEnv
    COAUTH_NO_SSL: "true"
    TZ: *TZ
  secrets:
    << : *rethinkdbClientSecrets
# core is the overide configuration for the embedded core subchart
core:
  enabled: true
  fullnameOverride: core
  configmap:
    # Service Hosts
    << : *etcdClientEnv
    << : *redisClientEnv
    << : *rethinkdbClientEnv
    # Environment
    << : *deploymentEnv
  secrets:
    << : *rethinkdbClientSecrets
# dispatch is the overide configuration for the embedded dispatch subchart
dispatch:
  enabled: true
  fullnameOverride: dispatch
  secrets:
    << : *dispatchSecrets
# frontends is the overide configuration for the embedded frontends subchart
frontends:
  enabled: true
  httpSidecar: true
  fullnameOverride: frontends
  configmap:
    PLACE_LOADER_WWW: www
    << : *rethinkdbClientEnv
    # Environment
    << : *deploymentEnv
  secrets:
    << : *rethinkdbClientSecrets
# rubbersoul is the overide configuration for the embedded rubber-soul subchart
rubbersoul:
  enabled: true
  fullnameOverride: rubbersoul
  configmap:
    # Service Hosts
    << : *rethinkdbClientEnv
    << : *elasticClientEnv
    # Environment
    << : *deploymentEnv
  secrets:
    << : *rethinkdbClientSecrets
# triggers is the overide configuration for the embedded triggers subchart
triggers:
  enabled: true
  fullnameOverride: triggers
  configmap:
    # Service Hosts
    << : *etcdClientEnv
    << : *redisClientEnv
    << : *rethinkdbClientEnv
    << : *smtpClientEnv
    # Environment
    << : *deploymentEnv
  secrets:
    << : *rethinkdbClientSecrets
    << : *smtpClientSecrets
# init is the overide configuration for the embedded init subchart
init:
  enabled: true
  config:
    # User/Application Configuration
    << : *initConfigEnv
    # Service Hosts
    << : *rethinkdbClientEnv
    << : *elasticClientEnv
    # Environment
    << : *deploymentEnv
    << : *rethinkdbClientSecrets
    PLACE_PASSWORD: *placePassword

###########################################
##### Third Party Supporting Services #####
###########################################

# These charts are not part of the PlaceOS core platform and are provided for development and PoC purposes.
# They are configured to run with minimal resource usage. Review the individual chart documentation and
# deploy seperately for a more robust solution.
etcd:
  enabled: false
  fullnameOverride: etcd
  auth:
    rbac:
      enabled: false
elasticsearch:
  enabled: false
  # templateOverrides. A work around to override the full name of the ElasticSearch master. See templates/_helpers.tpl
  templateOverrides:
    elasticsearchMasterfullName: elasticsearch-master
  master:
    replicas: 1
  data:
    replicas: 1
  coordinating:
    replicas: 0
rethinkdb:
  enabled: false
  # templateOverrides. A work around to override the full name of the RethinkDb full name. See templates/_helpers.tpl
  templateOverrides:
    rethinkdbFullName: rethinkdb
  cluster:
    replicas: 1
  rethinkdbPassword: *rethinkdbPassword
redis:
  enabled: false
  fullnameOverride: redis
  usePassword: false
  cluster:
    enabled: false
  configmap: |-
    notify-keyspace-events Kg$
influxdb:
  enabled: false
  fullnameOverride: influxdb
mosquitto:
  enabled: false
  fullnameOverride: mosquitto

global:
  #placeDomain the initial PlaceOS domain. Used by the init service to configure the appropriate domain services
  placeDomain: null
  #customRedirectPort the port the API and Frontend services are listening on. Leave as null if using standard ports. ie 80 or 443.
  # Used by the init service to configure the appropriate services
  customRedirectPort: null
