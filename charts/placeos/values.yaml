# -- Default values for the placeos umbrella chart.


###############################
##### Configmap Variable ######
###############################

# -- xrethinkdbPassword the admin password for RethinkDb.
# Used to set the admin password in RethinkDB if enabled then passed to multiple containers in a k8s secret
xrethinkdbPassword: &rethinkdbPassword "password"

# -- xsmtpPassword. the smtp password used by triggers
xsmtpPassword: &smtpPassword ""

# -- xplacePassword. The value used by the init subchart to set the default domain users password
xplacePassword: &placePassword "development"

# -- xserverSecret for the dispatch service
xserverSecret: &serverSecret "development"

# -- xtz the local time zone for the deployment
xtz: &TZ Australia/Sydney

# -- xdeploymentEnv configmap values exposed as environment variables to PlaceOS containers
xdeploymentEnv: &deploymentEnv
  ENV: development
  SG_ENV: development
  TZ: *TZ

# -- xelasticClientEnv configmap values for ElasticSearch Service exposed as environment variables to PlaceOS containers
xelasticClientEnv: &elasticClientEnv
  ES_HOST: elasticsearch-master
  ES_PORT: 9200

# -- xetcdClientEnv configmap values for Etcd end point Service as environment variables to PlaceOS containers
xetcdClientEnv: &etcdClientEnv
  ETCD_HOST: etcd-headless
  ETCD_PORT: 2379

# -- xplaceLoaderClientEnv configmap values for the frontend Service exposed as environment variables to PlaceOS containers
xplaceLoaderClientEnv: &placeLoaderClientEnv
  PLACE_LOADER_URI: http://frontends:3000

# -- xredisClientEnv configmap values for the redis Service exposed as environment variables to PlaceOS containers
xredisClientEnv: &redisClientEnv
  REDIS_URL: redis://redis-headless:6379

# -- xrethinkdbClientEnv configmap values for RethinkDB Service exposed as environment variables to PlaceOS containers
xrethinkdbClientEnv: &rethinkdbClientEnv
  # -- environment variable exposed to containers
  RETHINKDB_HOST: rethinkdb-proxy
  # -- environment variable exposed to containers
  RETHINKDB_PORT: 28015
  # -- environment variable exposed to containers
  RETHINKDB_DB: place_development
  # -- environment variable exposed to containers
  RETHINKDB_USER: admin

# -- xrethinkdbClientSecrets secret values for the rethinkdb password exposed as environment variables to PlaceOS containers
xrethinkdbClientSecrets: &rethinkdbClientSecrets
  # -- environment variable exposed to containers
  RETHINKDB_PASSWORD: *rethinkdbPassword

# -- xrubberSoulClientEnv configmap values for the Rubber Soul service exposed as environment variables to PlaceOS containers
xrubberSoulClientEnv: &rubberSoulClientEnv
  # -- environment variable exposed to containers
  RUBBER_SOUL_URI: http://rubbersoul:3000

# -- xsmtpClientEnv configmap values for the SMTP server exposed as environment variables for the trigger service
xsmtpClientEnv: &smtpClientEnv
  # -- environment variable exposed to containers
  SMTP_SERVER: ""
  # -- environment variable exposed to containers
  SMTP_PORT: 587
  # -- environment variable exposed to containers
  SMTP_USER: ""
  # -- environment variable exposed to containers
  SMTP_SECURE: ""

# -- initConfigEnv configmap values for the initialisation job exposed as environment variables for the init subchart
xinitConfigEnv: &initConfigEnv
  # -- environment variable exposed to containers
  PLACE_APPLICATION: backoffice
  # -- environment variable exposed to containers
  PLACE_AUTH_HOST: auth:3000
  # -- environment variable exposed to containers
  PLACE_USERNAME: "Place Support"
  # -- environment variable exposed to containers
  PLACE_EMAIL: support@place.tech
  # -- environment variable exposed to containers
  PLACE_TLS: true

# -- xsmtpClientSecrets secrets values exposed as environment variables for the trigger service
xsmtpClientSecrets: &smtpClientSecrets
  # -- environment variable exposed to containers
  SMTP_PASS: *smtpPassword

# -- dispatchSecrets secret values exposed as environment variables for the dispatch service
xdispatchSecrets: &dispatchSecrets
  # -- environment variable exposed to containers
  SERVER_SECRET: *serverSecret

#####################################
##### -- PlaceOS Service SubCharts #####
#####################################

# -- api is the overide configuration for the embedded api subchart
api:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: api
  # -- environment variable exposed to containers as a configmap
  configmap:
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
    # -- elasticache client variables
    << : *elasticClientEnv
    # -- etcd client variables
    << : *etcdClientEnv
    # -- Place Loader client variables
    << : *placeLoaderClientEnv
    # -- Redis DB client variables
    << : *redisClientEnv
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
    << : *rubberSoulClientEnv
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
# -- auth is the overide configuration for the embedded auth subchart
auth:
 # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: auth
  # -- environment variable exposed to containers
  configmap:
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
    COAUTH_NO_SSL: "true"
    TZ: *TZ
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
# -- core is the overide configuration for the embedded core subchart
core:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: core
  # -- environment variable exposed to containers
  configmap:
  # -- etcd client variables
    << : *etcdClientEnv
    # -- Redis DB client variables
    << : *redisClientEnv
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
# -- dispatch is the overide configuration for the embedded dispatch subchart
dispatch:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: dispatch
  # -- environment variable exposed to the container as secrets
  secrets:
    << : *dispatchSecrets
# -- frontends is the overide configuration for the embedded frontends subchart
frontends:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  httpSidecar: true
  fullnameOverride: frontends
  # -- environment variable exposed to containers
  configmap:
    # -- path to static html resources
    PLACE_LOADER_WWW: www
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
# -- rubbersoul is the overide configuration for the embedded rubber-soul subchart
rubbersoul:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: rubbersoul
  # -- environment variable exposed to containers
  configmap:
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
     # -- elasticache client variables
    << : *elasticClientEnv
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
# -- triggers is the overide configuration for the embedded triggers subchart
triggers:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: triggers
  # -- environment variable exposed to containers
  configmap:
  # -- etcd client variables
    << : *etcdClientEnv
    # -- Redis DB client variables
    << : *redisClientEnv
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
    # -- SMTP client variables
    << : *smtpClientEnv
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
    # -- SMTP client variables
    << : *smtpClientSecrets
# -- init is the overide configuration for the embedded init subchart
init:
  # -- a core PlaoceOS chart enabled by default.
  enabled: true
  fullnameOverride: init
  # -- environment variable exposed to containers
  config:
  # -- Place Domain initialisation variables
    << : *initConfigEnv
    # -- RethinkDB client variables
    << : *rethinkdbClientEnv
     # -- elasticache client variables
    << : *elasticClientEnv
    # -- PlaceOS deployment client variables
    << : *deploymentEnv
    # -- RethinkDB client variables
    << : *rethinkdbClientSecrets
  # -- environment variable exposed to the container as secrets
  secrets:
    # -- Default password for initial users in domain
    PLACE_PASSWORD: *placePassword

###########################################
##### -- Third Party Supporting Services #####
###########################################

# These charts are not part of the PlaceOS core platform and are provided for development and PoC purposes.
# They are configured to run with minimal resource usage. Review the individual chart documentation and
# deploy seperately for a more robust solution.
# -- etcd third party chart overrides
etcd:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  fullnameOverride: etcd
  auth:
    rbac:
      enabled: false
# -- elasticsearch third party chart overrides
elasticsearch:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  # -- templateOverrides. A work around to override the full name of the ElasticSearch master. See templates/_helpers.tpl
  templateOverrides:
    elasticsearchMasterfullName: elasticsearch-master
  master:
    replicas: 1
  data:
    replicas: 1
  coordinating:
    replicas: 0
# -- rethinkdb third party chart overrides
rethinkdb:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  # -- templateOverrides. A work around to override the full name of the RethinkDb deployment. See templates/_helpers.tpl
  templateOverrides:
    rethinkdbFullName: rethinkdb
  cluster:
    replicas: 1
  rethinkdbPassword: *rethinkdbPassword
# -- redis third party chart overrides
redis:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  fullnameOverride: redis
  usePassword: false
  cluster:
    enabled: false
  configmap: |-
    notify-keyspace-events Kg$
# -- influxdb third party chart overrides
influxdb:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  fullnameOverride: influxdb
# -- mosquitto third party chart overrides
mosquitto:
  # -- chart disabled by default. included for testing purposes only
  enabled: false
  fullnameOverride: mosquitto

global:
  #placeDomain the initial PlaceOS domain. Used by the init service to configure the appropriate domain services
  placeDomain: null
  # -- customRedirectPort the port the API and Frontend services are listening on. Leave as null if using standard ports. ie 80 or 443.
  # Used by the init service to configure the appropriate services
  customRedirectPort: null
